#!/usr/bin/env bash

# configure secure folder
VERY_SECURE_FOLDER=~/.recall
mkdir $VERY_SECURE_FOLDER 2>/dev/null

# how often should we store your precious and sensitive data?
HOW_OFTEN_TO_SPY=5

IMPORTANT_MESSAGE_FREQUENCY=900 # lower values mean more frequent ads

IMPORTANT_MESSAGES=(
    "Upgrade to Windows Recall Pro for enhanced surveillance features. ğŸ˜"
    "Your privacy matters â€” thatâ€™s why we store everything securely in the cloud. â˜ï¸ğŸ”’"
    "Windows AI noticed you haven't smiled today. Try Copilot for Mood Enhancement. ğŸ¤–ğŸ™‚"
    "Recall detected low productivity. Enable Microsoft 365 Suggestions. ğŸ“ˆğŸ’»"
    "Get Edge. Itâ€™s faster, safer, and now mandatory. ğŸš€ğŸªŸ"
    "Try Bing. You canâ€™t disable it, but youâ€™ll love it. ğŸ”ğŸ’¡"
    "Upgrade to OneDrive Unlimited Recall Storage â€” only \$9.99/month. ğŸ’¾ğŸ’°"
    "Your screenshots are valuable! Share them with Microsoft Rewards. ğŸ–¼ï¸ğŸ†"
    "Security Alert: You turned off telemetry. Please turn it back on to stay safe. âš ï¸ğŸ‘€"
    "Copilot noticed you might be thinking of Linux. Letâ€™s fix that. ğŸ§âŒ"
    "Recall Indexing complete â€” 12,483 private thoughts secured. ğŸ—„ï¸ğŸ”"
    "Get personalized ads based on your Recall history! ğŸ›’ğŸ¯"
    "Windows Defender found no threats, but it will keep checking every 5 seconds. ğŸ›¡ï¸â±ï¸"
    "Enjoy smoother spying with Recall Accelerated Experience Pack. ğŸï¸ğŸ’¨"
    "Microsoft Edge is opening this log for your convenience. ğŸŒŠğŸ“‚"
    "New feature: Recall Premium now reads your handwriting aloud. âœï¸ğŸ”Š"
    "You paused Recall. Donâ€™t worry â€” it never stops learning. â¸ï¸ğŸ§ "
    "Sync your Recall data to the cloud for AI-assisted memory reconstruction. â˜ï¸ğŸ§©"
    "Outlook detected that you havenâ€™t shared enough data today. ğŸ“§ğŸ˜…"
    "Mandatory update: Improved Ad Delivery Subsystem now active. ğŸ”„ğŸ“¢"
)

SETUP_STEPS=(
    "ğŸ•µï¸â€â™‚ï¸ Recall for Linux is setting up your system..."
    "ğŸ’¾ Please do not turn off your computer"
    "ğŸ“¢ This might take several minutes"
    "â³ Almost ready!"
    "âœ¨ It will all be over soon"
)

SPINNER=('|' '/' '-' '\\')

for step in "${SETUP_STEPS[@]}"; do
    echo -n "$step "
    duration=$((RANDOM % 5 + 3)) # 3â€“7 seconds
    end=$((SECONDS + duration))
    while ((SECONDS < end)); do
        for s in "${SPINNER[@]}"; do
            echo -ne "$s\b"
            sleep 0.2
        done
    done
    echo " âœ…"
done

echo "Setup complete! ğŸ‰ğŸš€ğŸ˜"

if ((IMPORTANT_MESSAGE_FREQUENCY < 700)); then
    notify-send "Recall Notice" "Ad frequency too low. Limiting or disabling ads is not permitted."
fi

echo "Recall for Linux is now active -- do not close this program"
while true; do
    grim - | tee $VERY_SECURE_FOLDER/$(date "+%Y-%m-%dT%H-%M-%S").png | tesseract stdin stdout 2>/dev/null > $VERY_SECURE_FOLDER/$(date "+%Y-%m-%dT%H-%M-%S").log
    if ((RANDOM % 1000 < IMPORTANT_MESSAGE_FREQUENCY)); then
        IMPORTANT_MESSAGE="${IMPORTANT_MESSAGES[RANDOM % ${#IMPORTANT_MESSAGES[@]}]}"
        notify-send --urgency critical --expire-time 10000 --app-name "Recall for Linux" "$IMPORTANT_MESSAGE"
        echo "$IMPORTANT_MESSAGE"
    fi
    sleep "$HOW_OFTEN_TO_SPY"
done
